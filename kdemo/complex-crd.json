{
  "apiVersion": "apiextensions.k8s.io/v1",
  "kind": "CustomResourceDefinition",
  "metadata": {
    "name": "microservices.example.com"
  },
  "spec": {
    "group": "example.com",
    "names": {
      "kind": "Microservice",
      "listKind": "MicroserviceList",
      "plural": "microservices",
      "singular": "microservice",
      "shortNames": [
        "ms",
        "msvc"
      ]
    },
    "scope": "Namespaced",
    "versions": [
      {
        "name": "v1",
        "served": true,
        "storage": true,
        "schema": {
          "openAPIV3Schema": {
            "type": "object",
            "required": [
              "spec"
            ],
            "properties": {
              "spec": {
                "type": "object",
                "required": [
                  "name",
                  "image"
                ],
                "properties": {
                  "name": {
                    "type": "string",
                    "description": "The name of the microservice"
                  },
                  "image": {
                    "type": "string",
                    "description": "Docker image for the microservice"
                  },
                  "version": {
                    "type": "string",
                    "description": "Version of the microservice"
                  },
                  "replicas": {
                    "type": "integer",
                    "minimum": 1,
                    "maximum": 10,
                    "default": 1
                  },
                  "resources": {
                    "type": "object",
                    "properties": {
                      "requests": {
                        "type": "object",
                        "properties": {
                          "cpu": {
                            "type": "string",
                            "default": "100m"
                          },
                          "memory": {
                            "type": "string",
                            "default": "128Mi"
                          }
                        }
                      },
                      "limits": {
                        "type": "object",
                        "properties": {
                          "cpu": {
                            "type": "string",
                            "default": "500m"
                          },
                          "memory": {
                            "type": "string",
                            "default": "512Mi"
                          }
                        }
                      }
                    }
                  },
                  "ports": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "required": [
                        "port"
                      ],
                      "properties": {
                        "name": {
                          "type": "string"
                        },
                        "port": {
                          "type": "integer",
                          "minimum": 1,
                          "maximum": 65535
                        },
                        "targetPort": {
                          "type": "integer"
                        },
                        "protocol": {
                          "type": "string",
                          "enum": [
                            "TCP",
                            "UDP"
                          ],
                          "default": "TCP"
                        }
                      }
                    }
                  },
                  "environment": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "required": [
                        "name"
                      ],
                      "properties": {
                        "name": {
                          "type": "string"
                        },
                        "value": {
                          "type": "string"
                        },
                        "valueFrom": {
                          "type": "object",
                          "properties": {
                            "configMapKeyRef": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string"
                                },
                                "key": {
                                  "type": "string"
                                }
                              }
                            },
                            "secretKeyRef": {
                              "type": "object",
                              "properties": {
                                "name": {
                                  "type": "string"
                                },
                                "key": {
                                  "type": "string"
                                }
                              }
                            }
                          }
                        }
                      }
                    }
                  },
                  "configMaps": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "required": [
                        "name"
                      ],
                      "properties": {
                        "name": {
                          "type": "string"
                        },
                        "mountPath": {
                          "type": "string"
                        }
                      }
                    }
                  },
                  "secrets": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "required": [
                        "name"
                      ],
                      "properties": {
                        "name": {
                          "type": "string"
                        },
                        "mountPath": {
                          "type": "string"
                        }
                      }
                    }
                  },
                  "healthCheck": {
                    "type": "object",
                    "properties": {
                      "livenessProbe": {
                        "type": "object",
                        "properties": {
                          "httpGet": {
                            "type": "object",
                            "properties": {
                              "path": {
                                "type": "string"
                              },
                              "port": {
                                "type": "integer"
                              }
                            }
                          },
                          "initialDelaySeconds": {
                            "type": "integer",
                            "default": 30
                          },
                          "periodSeconds": {
                            "type": "integer",
                            "default": 10
                          }
                        }
                      },
                      "readinessProbe": {
                        "type": "object",
                        "properties": {
                          "httpGet": {
                            "type": "object",
                            "properties": {
                              "path": {
                                "type": "string"
                              },
                              "port": {
                                "type": "integer"
                              }
                            }
                          },
                          "initialDelaySeconds": {
                            "type": "integer",
                            "default": 5
                          },
                          "periodSeconds": {
                            "type": "integer",
                            "default": 5
                          }
                        }
                      }
                    }
                  },
                  "networking": {
                    "type": "object",
                    "properties": {
                      "serviceType": {
                        "type": "string",
                        "enum": [
                          "ClusterIP",
                          "NodePort",
                          "LoadBalancer"
                        ],
                        "default": "ClusterIP"
                      },
                      "ingress": {
                        "type": "object",
                        "properties": {
                          "enabled": {
                            "type": "boolean",
                            "default": false
                          },
                          "host": {
                            "type": "string"
                          },
                          "path": {
                            "type": "string",
                            "default": "/"
                          },
                          "tls": {
                            "type": "boolean",
                            "default": false
                          }
                        }
                      }
                    }
                  }
                }
              },
              "status": {
                "type": "object",
                "properties": {
                  "phase": {
                    "type": "string",
                    "enum": [
                      "Pending",
                      "Running",
                      "Failed",
                      "Succeeded",
                      "Scaling"
                    ]
                  },
                  "replicas": {
                    "type": "integer"
                  },
                  "availableReplicas": {
                    "type": "integer"
                  },
                  "readyReplicas": {
                    "type": "integer"
                  },
                  "conditions": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "type": {
                          "type": "string"
                        },
                        "status": {
                          "type": "string"
                        },
                        "lastTransitionTime": {
                          "type": "string",
                          "format": "date-time"
                        },
                        "reason": {
                          "type": "string"
                        },
                        "message": {
                          "type": "string"
                        }
                      }
                    }
                  },
                  "endpoints": {
                    "type": "array",
                    "items": {
                      "type": "object",
                      "properties": {
                        "name": {
                          "type": "string"
                        },
                        "port": {
                          "type": "integer"
                        },
                        "protocol": {
                          "type": "string"
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        },
        "additionalPrinterColumns": [
          {
            "name": "Name",
            "type": "string",
            "jsonPath": ".spec.name"
          },
          {
            "name": "Image",
            "type": "string",
            "jsonPath": ".spec.image"
          },
          {
            "name": "Version",
            "type": "string",
            "jsonPath": ".spec.version"
          },
          {
            "name": "Replicas",
            "type": "integer",
            "jsonPath": ".spec.replicas"
          },
          {
            "name": "Phase",
            "type": "string",
            "jsonPath": ".status.phase"
          },
          {
            "name": "Age",
            "type": "date",
            "jsonPath": ".metadata.creationTimestamp"
          }
        ]
      }
    ]
  }
}
